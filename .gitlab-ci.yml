image: docker:stable
stages:
#  - build
#  - test
  - deploy
variables:
  IMAGE_TAG: $CI_REGISTRY_IMAGE/node:$CI_COMMIT_REF_SLUG
#build:
#  stage: build
#  services:
#    - docker:dind
#  script:
#    - docker login -u gitlab-ci-token -p $CI_JOB_TOKEN $CI_REGISTRY
#    - docker build -t $IMAGE_TAG .
#    - docker push $IMAGE_TAG
#test:
#  image: $IMAGE_TAG
#  stage: test
#  script:
#    - cd /app
#    - yarn test
pages:
  image: .
  stage: deploy
  script:
    - yarn install
    - yarn build
    - rm -rf public
    - mv build public
    - cp public/index.html public/404.html
  artifacts:
    paths:
      - public
  only:
    - master
    - member-info
